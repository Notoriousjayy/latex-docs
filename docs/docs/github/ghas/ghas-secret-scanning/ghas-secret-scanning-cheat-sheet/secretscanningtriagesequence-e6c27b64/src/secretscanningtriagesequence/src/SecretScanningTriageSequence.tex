digraph SecretScanning_Triage_Sequence {
  graph [rankdir=TB, splines=ortho, fontname="Helvetica",
         label="Secret Scanning Triage — Sequence Diagram (derived from SOP)",
         labelloc="t", fontsize=20, pad=0.4];

  // ---------- Defaults ----------
  node [shape=point, width=0.02, height=0.02, label="", fontname="Helvetica"];
  edge [fontname="Helvetica", fontsize=10];

  // ---------- Participants (lifeline headers) ----------
  { rank=same;
    G0 [shape=box, style="rounded,filled", fillcolor="#eef3fb",
        label="GitHub\n(Push Protection / PR Alerts / Retro Scan)"];
    D0 [shape=box, style="rounded,filled", fillcolor="#eef7ee",
        label="Developer / Committer"];
    R0 [shape=box, style="rounded,filled", fillcolor="#eef7ff",
        label="Code Owner / Reviewer"];
    S0 [shape=box, style="rounded,filled", fillcolor="#fff7e6",
        label="Security (AppSec / IR)"];
    C0 [shape=box, style="rounded,filled", fillcolor="#fffbe6",
        label="Credential Owner"];
    O0 [shape=box, style="rounded,filled", fillcolor="#f7eefe",
        label="Service Owner\n(Repo/Platform)"];
    I0 [shape=box, style="rounded,filled", fillcolor="#fdeef0",
        label="Incident Channel\n(PagerDuty / Slack)"];
  }

  // ---------- Time grid (one row per step; points align columns) ----------
  // t1..t16
  {rank=same; G1; D1; R1; S1; C1; O1; I1;}
  {rank=same; G2; D2; R2; S2; C2; O2; I2;}
  {rank=same; G3; D3; R3; S3; C3; O3; I3;}
  {rank=same; G4; D4; R4; S4; C4; O4; I4;}
  {rank=same; G5; D5; R5; S5; C5; O5; I5;}
  {rank=same; G6; D6; R6; S6; C6; O6; I6;}
  {rank=same; G7; D7; R7; S7; C7; O7; I7;}
  {rank=same; G8; D8; R8; S8; C8; O8; I8;}
  {rank=same; G9; D9; R9; S9; C9; O9; I9;}
  {rank=same; G10; D10; R10; S10; C10; O10; I10;}
  {rank=same; G11; D11; R11; S11; C11; O11; I11;}
  {rank=same; G12; D12; R12; S12; C12; O12; I12;}
  {rank=same; G13; D13; R13; S13; C13; O13; I13;}
  {rank=same; G14; D14; R14; S14; C14; O14; I14;}
  {rank=same; G15; D15; R15; S15; C15; O15; I15;}
  {rank=same; G16; D16; R16; S16; C16; O16; I16;}

  // ---------- Lifelines ----------
  edge [style=dashed, color="#aaaaaa", arrowhead=none];
  G0->G1->G2->G3->G4->G5->G6->G7->G8->G9->G10->G11->G12->G13->G14->G15->G16;
  D0->D1->D2->D3->D4->D5->D6->D7->D8->D9->D10->D11->D12->D13->D14->D15->D16;
  R0->R1->R2->R3->R4->R5->R6->R7->R8->R9->R10->R11->R12->R13->R14->R15->R16;
  S0->S1->S2->S3->S4->S5->S6->S7->S8->S9->S10->S11->S12->S13->S14->S15->S16;
  C0->C1->C2->C3->C4->C5->C6->C7->C8->C9->C10->C11->C12->C13->C14->C15->C16;
  O0->O1->O2->O3->O4->O5->O6->O7->O8->O9->O10->O11->O12->O13->O14->O15->O16;
  I0->I1->I2->I3->I4->I5->I6->I7->I8->I9->I10->I11->I12->I13->I14->I15->I16;

  // ---------- Messages ----------
  edge [style=solid, color="#333333", arrowhead=normal, constraint=false];

  // Detection & assignment
  G1 -> D1 [label="Secret detected → Open GH alert"];
  G1 -> S1 [label="Notify Security"];
  G1 -> R1 [label="Auto-assign to CODEOWNERS"];

  // Ack & triage
  D2 -> G2 [label="Acknowledge assignment"];
  D3 -> S3 [label="Verify finding & add triage notes"];

  // Branch: False positive
  D4 -> S4 [label="If false positive → document reason"];
  S4 -> G4 [label="Dismiss as false positive"];
  G4 -> D4 [label="Alert closed (FP)"];

  // Valid secret path
  D5 -> G5 [label="Contain/Remove secret & push fix"];
  D6 -> O6 [label="Secret in history? → open history rewrite ticket (if yes)"];
  D7 -> C7 [label="Request credential rotation"];
  C8 -> S8 [label="Rotate/Revoke credential → confirm invalidation"];
  S8 -> D8 [label="Post confirmation to issue / PR"];

  // Exception: Push Protection override
  G6 -> S6 [label="Push Protection override?"];
  S6 -> S7 [label="Review exception request / approve or deny"];

  // Incident handling (severity-based)
  S9 -> S9 [label="Classify severity (P0/P1?)"];
  S9 -> I9 [label="If P0/P1 → page incident channel"];
  I10 -> S10 [label="Incident channel active"];
  S11 -> D11 [label="Containment guidance / Recover & harden"];
  S11 -> O11 [label="Platform mitigations / hardening"];
  S12 -> S12 [label="Weekly / Monthly reporting"];

  // Remediation PR & review
  D12 -> R12 [label="Open remediation PR"];
  R13 -> D13 [label="Review PR / feedback"];
  R14 -> G14 [label="Approve & merge"];

  // Closeout
  G15 -> D15 [label="Alert auto-closed after merge/rotation"];
  G15 -> S15 [label="Audit trail updated"];
  G16 -> R16 [label="Notify CODEOWNERS (done)"];
}

