% !TEX TS-program = pdflatex
\documentclass[11pt,a4paper,oneside,notitlepage]{article}

% ---------- Page & typography ----------
\usepackage[a4paper,margin=1in]{geometry}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{lmodern}
\usepackage{microtype}
\usepackage{parskip}
\raggedbottom

% ---------- Color & links ----------
\usepackage[dvipsnames]{xcolor}
\usepackage{hyperref}
\hypersetup{
  colorlinks=true,
  linkcolor=MidnightBlue,
  urlcolor=MidnightBlue,
  citecolor=MidnightBlue
}

% ---------- Structure ----------
\usepackage{enumitem}
\setlist{itemsep=4pt, topsep=4pt, leftmargin=1.2em}

% ---------- Tables & callouts ----------
\usepackage{booktabs}
\usepackage[most]{tcolorbox}
\tcbset{colback=gray!3, colframe=MidnightBlue!50, arc=2mm, left=6pt, right=6pt, boxsep=4pt}

% ---------- Code listings (minted) ----------
\usepackage[newfloat]{minted}
\usemintedstyle{friendly}
\SetupFloatingEnvironment{listing}{name=Listing}
\setminted{linenos, breaklines, fontsize=\small, tabsize=2}

\begin{document}

% ---------- Front matter (guarded: no automatic blank page) ----------
\begingroup
\let\clearpage\relax
\let\cleardoublepage\relax
\thispagestyle{plain}
\begin{center}
{\LARGE \textbf{GitHub Advanced Security (GHAS) Secret Scanning}}\\[2pt]
{\large Standard Operating Procedure \& Quick-Start Guide}\\[10pt]
Prepared for: Security \& Platform Engineering\\[6pt]
\today
\end{center}
\vspace{0.75\baselineskip}

\begin{tcolorbox}
\textbf{Purpose.} This document defines a pragmatic, auditable way to enable, route, triage, and maintain
GitHub Advanced Security \emph{Secret Scanning} across the organization. It includes
a quick-start checklist, operating procedures, and ready-to-use configuration.
\end{tcolorbox}
\endgroup

\section*{Executive Summary}
\begin{itemize}
  \item \textbf{Minimize alert fatigue:} scope visibility to responders who must act (org-/repo-level).
  \item \textbf{Catch issues early:} enable \emph{Push Protection} so secrets are blocked before they land.
  \item \textbf{Reduce noise safely:} use \texttt{.github/secret\_scanning.yml} with conservative \texttt{paths-ignore}.
  \item \textbf{Detect internal tokens:} add org-level custom patterns; allow repo overrides when necessary.
  \item \textbf{Faster response:} send alerts to Teams/Slack/PagerDuty via a lightweight GitHub Actions workflow.
  \item \textbf{Accountability:} require dismissal reasons; review periodically for compliance and tuning.
\end{itemize}

\section{Scope \& Roles}
\begin{table}[h]
\centering
\begin{tabular}{@{}llp{8cm}@{}}
\toprule
\textbf{Role} & \textbf{Area} & \textbf{Responsibilities} \\
\midrule
Security Engineering & Policy \& Tuning & Org-level enablement, custom patterns, dismissal governance, quarterly tuning. \\
Platform/DevEx & Tooling \& Routing & Notification integrations (Teams/Slack), sample workflows, templates. \\
Repo Maintainers & Project Setup & Adopt org defaults, minimal overrides, triage participation. \\
Incident Response & Response & Containment, key rotation, partner validity checks, post-incident review. \\
\bottomrule
\end{tabular}
\end{table}

\section{Quick-Start Checklist}
\begin{enumerate}
  \item \textbf{Enable} Secret Scanning and \textbf{Push Protection} org-wide.
  \item Create \texttt{.github/secret\_scanning.yml} with \emph{minimal} \texttt{paths-ignore}; avoid broad exclusions.
  \item Define \textbf{org-level custom patterns} for internal tokens; document samples and test regex in the UI.
  \item Grant a \textbf{Security Team} permissions to triage/manage alerts; scope contributor visibility appropriately.
  \item Wire \textbf{Teams/Slack/PagerDuty} notifications via GitHub Actions and a channel/webhook.
  \item \textbf{Require dismissal reasons}; review monthly in Security Overview; remediate recurring root causes.
\end{enumerate}

\section{Operating Procedure (SOP)}
\subsection{Enablement}
\begin{enumerate}[label=\alph*)]
  \item Org Owners enable Secret Scanning and Push Protection at the organization level.
  \item Security Engineering publishes an org-wide baseline \texttt{.github/secret\_scanning.yml}.
\end{enumerate}

\subsection{Notification Routing}
\begin{enumerate}[label=\alph*)]
  \item Platform team deploys a reusable workflow (see Listing~\ref{lst:teams-workflow}) posting alerts to chosen channels.
  \item Each repo references the reusable or local workflow; secrets for webhooks are stored in GitHub Secrets.
\end{enumerate}

\subsection{Triage \& Response}
\begin{enumerate}[label=\alph*)]
  \item Alert received $\rightarrow$ \textbf{Acknowledge} in channel; assign an on-call/responder.
  \item \textbf{Validate} via provider/partner checks when available (is the key active?). Disable/rotate immediately if active.
  \item \textbf{Containment:} revoke/rotate token, purge from code if necessary, update IaC/secrets manager.
  \item \textbf{Dismissal policy:} only use allowed reasons (see Section~\ref{sec:dismissal}); justification is \emph{required}.
  \item \textbf{Post-incident:} add tests/rules to prevent recurrence; capture learnings; adjust patterns/exclusions.
\end{enumerate}

\subsection{Maintenance Cadence}
\begin{itemize}
  \item \textbf{Monthly:} review dismissal reasons \& recurring patterns; refine custom patterns or exclusions.
  \item \textbf{Quarterly:} org-wide health check (coverage, false positive rate, MTTA/MTTR); re-validate routing.
\end{itemize}

\section{Dismissal Governance}\label{sec:dismissal}
\begin{tcolorbox}
\textbf{Allowed dismissal categories (examples):}
\begin{itemize}
  \item \textbf{Pattern Test/Example:} dummy token in docs or sample files (prefer moving to \texttt{*.sample}).
  \item \textbf{Revoked/Inactive:} provider confirms token is inactive; evidence linked in comment.
  \item \textbf{False Positive:} string matches regex but is not a credential; include proof (e.g., format contract).
\end{itemize}
\end{tcolorbox}
\noindent
Every dismissal must include a meaningful justification and, when applicable, an evidence link or ticket.

\section{Configuration Reference}
\subsection{\texttt{.github/secret\_scanning.yml} (baseline)}
\begin{listing}[h]
\caption{\texttt{.github/secret\_scanning.yml} baseline}\label{lst:secret-yaml}
\begin{minted}{yaml}
# Scope carefully; start small and review quarterly
paths-ignore:
  - "deployment/**"        # example: generated configs or manifests
  - "**/*.sample"          # example: sample files with fake secrets

validity-checks: true       # attempt provider validation when possible

# Optional: ignore branches/tags if needed (be conservative)
branches-ignore:
  - "experiment/**"
tags-ignore:
  - "archive-*"
\end{minted}
\end{listing}

\subsection{Teams Notification Workflow (example)}
\begin{listing}[h]
\caption{GitHub Actions workflow: Post signal to Microsoft Teams}
\label{lst:teams-workflow}
\begin{minted}{yaml}
name: Secret scan alert to Teams
on:
  workflow_dispatch: {}
  pull_request:
    types: [opened, reopened, synchronize]
    branches: [main]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Post to Teams
        uses: fjogeleit/http-request-action@v1
        with:
          url: ${{ secrets.TEAMS_WEBHOOK_URL }}
          method: POST
          data: |
            {
              "text": "Secret scanning signal: PR #${{ github.event.pull_request.number }} in ${{ github.repository }} needs review."
            }
\end{minted}
\end{listing}

\begin{tcolorbox}
\textbf{Security notes.} Store all webhooks/tokens in \emph{org- or repo-level} GitHub Secrets. Restrict who can read or update these secrets. Prefer a dedicated channel and rotate webhook URLs when staff changes.
\end{tcolorbox}

\section{Appendix}
\subsection*{Change Log Template}
\begin{itemize}
  \item v1.0 --- Initial publication; org baseline, routing workflow, dismissal policy.
\end{itemize}

\end{document}