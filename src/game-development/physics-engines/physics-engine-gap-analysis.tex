% physics-engine-gap-analysis.tex
% CI-safe: No minted, no Pygments, no shell-escape required
\documentclass[11pt]{article}

% === Encoding & Fonts ===
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{lmodern}
\usepackage{microtype}

% === Page Layout ===
\usepackage[margin=1in]{geometry}
\usepackage{parskip}

% === Math ===
\usepackage{amssymb}
\usepackage{textcomp}

% === Tables ===
\usepackage{booktabs}
\usepackage{tabularx}
\usepackage{array}

% === Lists ===
\usepackage{enumitem}
\setlist[itemize]{noitemsep, topsep=2pt}
\setlist[description]{style=nextline, leftmargin=3cm, labelsep=0.6cm, font=\normalfont\bfseries}

% === Colors ===
\usepackage{xcolor}
\definecolor{CodeBg}{HTML}{F3F4F6}

% === Hyperlinks ===
\usepackage[hidelinks]{hyperref}

% === Status Symbols ===
\newcommand{\Impl}{\checkmark}
\newcommand{\Part}{\textopenbullet}
\newcommand{\Miss}{$\times$}
\newcommand{\Dup}{$\star$}

% === Code Blocks (listings only) ===
\usepackage{listings}
\usepackage{upquote}

\lstset{
  basicstyle=\ttfamily\small,
  backgroundcolor=\color{CodeBg},
  breaklines=true,
  columns=fullflexible,
  keepspaces=true,
  showstringspaces=false,
  frame=single,
  framerule=0.4pt,
  tabsize=2,
  aboveskip=8pt,
  belowskip=8pt
}

\lstnewenvironment{jsoncode}{\lstset{}}{}

% === Silence missing .toc on first run ===
\makeatletter
\let\orig@starttoc\@starttoc
\def\@starttoc#1{\IfFileExists{\jobname.#1}{\orig@starttoc{#1}}{}}
\makeatother

% === Document ===
\title{Physics Engine Gap Analysis\\\large Combined Repository Analysis for Production-Grade Physics \& Numerical Algorithms Library}
\author{}
\date{December 18, 2025}

\begin{document}
\maketitle

\section{Executive Summary}

\subsection{Repository Overview}

This analysis examines three repositories intended to form a coherent physics engine and numerical algorithms library:

\begin{description}
\item[Jet Fluid Engine] Production-grade fluid simulation with SPH, FLIP/PIC/APIC, grid-based solvers, level sets, and FDM linear system solvers. Strong in computational physics but lacks rigid body dynamics.
\item[Game Physics Cookbook] Rigid body physics with SAT collision detection, impulse-based response, cloth simulation, and spatial partitioning. Strong in game physics but lacks advanced numerical methods.
\item[Numerical Recipes] Collection of numerical algorithms including ODE solvers (RK4), integration routines, linear solvers, and statistical functions.
\end{description}

\subsection{Key Findings}

\begin{description}
\item[Critical Gap] No unified constraint solver architecture bridges rigid bodies and fluids.
\item[Major Overlap] Duplicate math primitives requiring unification.
\item[Architectural Mismatch] Different coordinate conventions and memory layouts.
\item[Partial Implementation] Broadphase collision limited to QuadTree/Octree.
\end{description}

\subsection{Strategic Recommendation}

Adopt Jet's modular architecture as the foundation, integrate Game Physics Cookbook's rigid body system as a new module, and incorporate Numerical Recipes algorithms into a unified MathPrimitives/Numerics layer. Estimated effort: 16--24 person-months.

\section{Capability Coverage Matrix}

Legend: \Impl{} = Implemented \quad \Part{} = Partial \quad \Miss{} = Missing \quad \Dup{} = Duplicate

\subsection{Core Math \& Numerics}

\begin{table}[htbp]
\centering
\small
\caption{Core Math \& Numerics --- Capability Coverage}
\begin{tabularx}{\textwidth}{@{} p{3cm} X X X @{}}
\toprule
\textbf{Capability} & \textbf{Jet} & \textbf{Cookbook} & \textbf{NumRecipes} \\
\midrule
Vector/Matrix & \Impl{} Vector2/3, Matrix & \Dup{} vec2/3, mat2/3/4 & \Miss{} \\
Transform Types & \Impl{} Transform2/3 & \Part{} mat4 functions & \Miss{} \\
Sparse Solvers & \Impl{} CG, ICCG, Jacobi & \Miss{} & \Part{} tridag, sor \\
ODE Solvers & \Part{} Semi-implicit Euler & \Part{} Euler/Verlet & \Impl{} rk4 \\
Interpolation & \Impl{} Cubic interp & \Miss{} & \Impl{} interp\_linear \\
\bottomrule
\end{tabularx}
\end{table}

\subsection{Rigid Body Physics}

\begin{table}[htbp]
\centering
\small
\caption{Rigid Body Physics --- Capability Coverage}
\begin{tabularx}{\textwidth}{@{} p{3cm} X X X @{}}
\toprule
\textbf{Capability} & \textbf{Jet} & \textbf{Cookbook} & \textbf{NumRecipes} \\
\midrule
Rigid Body State & \Part{} RigidBodyCollider & \Impl{} RigidbodyVolume & \Miss{} \\
Broadphase & \Impl{} PointHashGrid & \Impl{} QuadTree, Octree & \Miss{} \\
Narrowphase (GJK) & \Miss{} & \Miss{} & \Miss{} \\
Narrowphase (SAT) & \Miss{} & \Impl{} SAT for OBB & \Miss{} \\
Contact Manifold & \Miss{} & \Impl{} CollisionManifold & \Miss{} \\
Impulse Resolution & \Miss{} & \Impl{} ApplyImpulse() & \Miss{} \\
Constraints/Joints & \Miss{} & \Part{} DistanceJoint & \Miss{} \\
CCD (Continuous) & \Miss{} & \Miss{} & \Miss{} \\
\bottomrule
\end{tabularx}
\end{table}

\subsection{Fluids}

\begin{table}[htbp]
\centering
\small
\caption{Fluids --- Capability Coverage}
\begin{tabularx}{\textwidth}{@{} p{3cm} X X X @{}}
\toprule
\textbf{Capability} & \textbf{Jet} & \textbf{Cookbook} & \textbf{NumRecipes} \\
\midrule
Grid-Based Eulerian & \Impl{} GridFluidSolver & \Miss{} & \Miss{} \\
Pressure Projection & \Impl{} GridPressureSolver & \Miss{} & \Miss{} \\
SPH & \Impl{} SphSolver2/3 & \Miss{} & \Miss{} \\
FLIP/PIC/APIC & \Impl{} FlipSolver, ApicSolver & \Miss{} & \Miss{} \\
Level Sets & \Impl{} LevelSetSolver, FMM & \Miss{} & \Miss{} \\
Marching Cubes & \Impl{} marching\_cubes.h & \Miss{} & \Miss{} \\
\bottomrule
\end{tabularx}
\end{table}

\section{Critical Gaps}

\subsection{Gap 1: GJK/EPA Narrowphase Collision}

\begin{description}
\item[Description] No Gilbert-Johnson-Keerthi or Expanding Polytope Algorithm for convex hull collision.
\item[Current State] Missing entirely. Cookbook has SAT for OBB/AABB only.
\item[Impact] Cannot handle arbitrary convex colliders.
\item[Effort] Large (3--4 weeks)
\end{description}

\subsection{Gap 2: Unified Constraint Solver}

\begin{description}
\item[Description] No centralized constraint solver architecture.
\item[Current State] Partial --- ad-hoc impulse iteration exists but no proper PGS/MLCP.
\item[Impact] Joint stacking and complex constraints fail.
\item[Effort] Large (4--5 weeks)
\end{description}

\subsection{Gap 3: Continuous Collision Detection (CCD)}

\begin{description}
\item[Description] No time-of-impact calculation for fast-moving objects.
\item[Current State] Missing entirely.
\item[Impact] Fast projectiles tunnel through thin walls.
\item[Effort] Medium (2--3 weeks)
\end{description}

\subsection{Gap 4: Island Management \& Sleeping}

\begin{description}
\item[Description] No grouping of interacting bodies into islands or sleep state management.
\item[Current State] Missing entirely.
\item[Impact] O(n\textsuperscript{2}) collision checks regardless of activity.
\item[Effort] Medium (2 weeks)
\end{description}

\section{Overlap/Conflict List}

\subsection{Math Type System Duplication}

\begin{description}
\item[Overlap] Jet uses templated Vector2<T>/Vector3<T>. Cookbook uses float-only vec2/vec3.
\item[Risk] Type mismatches at module boundaries.
\item[Recommendation] Adopt Jet's templated types as canonical; create thin adapters.
\end{description}

\subsection{Coordinate System / Handedness}

\begin{description}
\item[Conflict] Jet does not explicitly define handedness. Cookbook uses left-handed OpenGL conventions.
\item[Recommendation] Document and enforce right-handed Y-up convention throughout.
\end{description}

\section{Prioritized Roadmap}

\subsection{Phase 0: Safety \& Baseline (4--6 weeks)}

\begin{itemize}
  \item CI/CD Pipeline with GitHub Actions
  \item Unit Test Framework (Google Test); achieve 60\% coverage
  \item Determinism Audit
  \item Module README Files
\end{itemize}

\subsection{Phase 1: Core Math Unification (3--4 weeks)}

\begin{itemize}
  \item Math Type Consolidation
  \item Numeric Utilities Integration (port rk4, romberg)
  \item Coordinate System Documentation
\end{itemize}

\subsection{Phase 2: Rigid Body Integration (6--8 weeks)}

\begin{itemize}
  \item Rigid Body Module port
  \item GJK/EPA Implementation
  \item Sequential Impulses Solver
  \item Joint System (Distance, Hinge, Ball-socket)
\end{itemize}

\subsection{Phase 3: Collision Optimization (4--5 weeks)}

\begin{itemize}
  \item Dynamic BVH
  \item Island Management
  \item CCD Implementation
\end{itemize}

\subsection{Phase 4: Advanced Features (8+ weeks)}

\begin{itemize}
  \item PBD/XPBD System
  \item Fluid-Rigid Coupling
  \item GPU Acceleration
\end{itemize}

\section{Key Interfaces to Define}

\begin{table}[htbp]
\centering
\small
\caption{Key Interfaces}
\begin{tabularx}{\textwidth}{@{} p{3cm} p{3.5cm} X @{}}
\toprule
\textbf{Interface} & \textbf{Module} & \textbf{Purpose} \\
\midrule
ICollider & CollisionDetection & Abstract collision shape \\
IBroadphase & CollisionDetection & Spatial acceleration query \\
IConstraint & ConstraintSolver & Base for all constraints \\
IIntegrator & Numerics & ODE step function \\
IRigidBody & RigidBody & State access interface \\
IPhysicsWorld & Animation & Unified world manager \\
\bottomrule
\end{tabularx}
\end{table}

\begin{center}
\textit{End of Gap Analysis Report}
\end{center}

\end{document}
