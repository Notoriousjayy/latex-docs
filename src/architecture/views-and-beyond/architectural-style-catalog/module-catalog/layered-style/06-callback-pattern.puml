@startuml
skinparam backgroundColor #FEFEFE
skinparam defaultFontSize 12
skinparam shadowing false
skinparam rectangleRoundCorner 8
skinparam rectangleFontSize 13
skinparam rectangleFontStyle bold

title Layering with Callback Pattern\nLower layers invoke callbacks without depending on higher layers

rectangle "**Application Layer**" as APP #CCE5CC {
  rectangle "OrderService" as os #E0F0E0
  rectangle "implements\nOnPaymentComplete" as impl #E0F0E0
}

rectangle "**Domain Layer**" as DOM #FFE0B2 {
  rectangle "PaymentProcessor" as pp #FFF0D6
  rectangle "<<interface>>\nOnPaymentComplete" as cb #FFF0D6
}

os -[#3366AA]-> pp : uses
impl ..[#339933]..|> cb : implements

pp -[#CC6633]-> cb : invokes\ncallback

note right of cb
  The interface is defined
  in the **lower** layer.
  The higher layer provides
  the implementation.
  Dependency direction is
  preserved.
end note

note bottom
  **Benefit:** Lower layers can notify higher layers
  without creating upward dependencies.
  Used for event notification, plugin systems,
  and framework extension points.
end note
@enduml
