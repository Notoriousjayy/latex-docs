@startuml 08-common-patterns
!define BLUE #4A90D9
!define LBLUE #E8F0FE
!define GREEN #5BA85B
!define LGREEN #E8F5E8
!define ORANGE #D4763C
!define LORANGE #FDE8D8
!define PURPLE #7B68AE
!define LPURPLE #EDE8F5

skinparam backgroundColor white
skinparam defaultFontName "Helvetica"
skinparam defaultFontSize 11
skinparam shadowing false
skinparam roundCorner 4

skinparam class {
  FontSize 11
  AttributeFontSize 9
}

skinparam package {
  FontSize 13
  BorderThickness 2
}

title <size:18><b>Common Data Model Patterns</b></size>\n<size:12>Recurring solutions to common modeling challenges</size>

package "Audit Trail Pattern" as pkg1 #E8F0FE {
  class "Employee" as emp1 #FFFFFF {
    employee_id : UUID <<PK>>
    name : String
    salary : Decimal
    --
    **created_by** : String
    **created_at** : DateTime
    **modified_by** : String
    **modified_at** : DateTime
  }
  class "Employee_Audit" as empaud #FFFFFF {
    audit_id : UUID <<PK>>
    employee_id : UUID <<FK>>
    change_type : Enum
    old_values : JSON
    new_values : JSON
    changed_by : String
    changed_at : DateTime
  }
  emp1 "1" -- "0..*" empaud : tracks >
}

package "Soft Delete Pattern" as pkg2 #E8F5E8 {
  class "Document" as doc #FFFFFF {
    document_id : UUID <<PK>>
    title : String
    content : Text
    --
    **is_deleted** : Boolean
    **deleted_at** : DateTime
    **deleted_by** : String
  }
  note bottom of doc
    Queries filter:
    WHERE is_deleted = FALSE
  end note
}

package "Self-Referencing Pattern" as pkg3 #FDE8D8 {
  class "Category" as cat2 #FFFFFF {
    category_id : UUID <<PK>>
    **parent_id** : UUID <<FK>>
    name : String
    level : Integer
  }
  cat2 "0..*" --> "0..1" cat2 : parent
}

package "SCD Type 2 Pattern" as pkg4 #EDE8F5 {
  class "ProductPrice" as pp #FFFFFF {
    product_id : UUID <<FK>>
    price : Decimal
    **effective_from** : Date
    **effective_to** : Date
    **is_current** : Boolean
    version : Integer
  }
  note bottom of pp
    Full history preserved.
    Queries use is_current
    or date range filters.
  end note
}

@enduml
