@startuml
skinparam backgroundColor #FFFFFF
skinparam defaultFontName Arial
skinparam defaultFontSize 11
skinparam shadowing false

skinparam node {
    BackgroundColor #E3F2FD
    BorderColor #1565C0
    FontColor #0D47A1
}

skinparam artifact {
    BackgroundColor #FFF3E0
    BorderColor #EF6C00
    FontColor #E65100
}

skinparam rectangle {
    BackgroundColor #F5F5F5
    BorderColor #757575
}

title Three-Tier Web Application Deployment

actor "Users" as users

rectangle "DMZ (Public Subnet)" as dmz {
    rectangle "Load\nBalancer" as lb
    
    node "Web Server 1" as ws1 {
        artifact "nginx" as nginx1
    }
    node "Web Server 2" as ws2 {
        artifact "nginx" as nginx2
    }
}

rectangle "Private Subnet" as private {
    node "App Server 1" as as1 {
        artifact "App\nService" as app1
    }
    node "App Server 2" as as2 {
        artifact "App\nService" as app2
    }
}

rectangle "Restricted Subnet" as restricted {
    node "DB Primary" as dbPrimary {
        artifact "PostgreSQL\n(primary)" as pgPrimary
    }
    node "DB Replica" as dbReplica {
        artifact "PostgreSQL\n(replica)" as pgReplica
    }
}

users --> lb : HTTPS
lb --> nginx1 : HTTP
lb --> nginx2 : HTTP
nginx1 --> app1 : reverse proxy
nginx2 --> app2
app1 --> pgPrimary : TCP:5432
app2 --> pgPrimary
pgPrimary --> pgReplica : replication

note bottom
  Network segmentation: Web tier in DMZ, App tier in private, Data tier in restricted
  Allocation decisions: Instance count per tier, instance sizing, load balancing strategy
end note

@enduml
