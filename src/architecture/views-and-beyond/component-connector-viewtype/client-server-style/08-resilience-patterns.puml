@startuml
skinparam backgroundColor white
skinparam defaultFontName Arial
skinparam defaultFontSize 11
skinparam shadowing false
skinparam roundCorner 5

skinparam rectangle {
    BorderColor #424242
}

skinparam package {
    BackgroundColor #FAFAFA
    BorderColor #BDBDBD
}

title Error Handling and Resilience Patterns

package "Client-Side Resilience" {
    rectangle "Timeout\nHandling" as TO #FFF3E0
    rectangle "Retry with\nBackoff" as RET #FFF3E0
    rectangle "Fallback\nBehavior" as FB #FFF3E0
    
    TO -r-> RET : failure
    RET -r-> FB : exhausted
}

package "Circuit Breaker Pattern" {
    rectangle "Closed\n(Normal)" as CLOSED #C8E6C9
    rectangle "Open\n(Fast Fail)" as OPEN #FFCDD2
    rectangle "Half-Open\n(Test)" as HALF #FFE0B2
    
    CLOSED --> CLOSED : success
    CLOSED --> OPEN : failures
    OPEN --> HALF : timeout
    HALF --> CLOSED : probe ok
    HALF --> OPEN : probe fail
}

package "Server-Side Resilience" {
    rectangle "Graceful\nDegradation" as GD #E8F5E9
    rectangle "Bulkhead\nIsolation" as BH #E8F5E9
    rectangle "Health\nChecks" as HC #E8F5E9
    
    GD -r-> BH
    BH -r-> HC
}

note bottom of GD : Partial functionality\nduring partial failures
note bottom of BH : Isolate failures\nprevent cascade
note bottom of HC : LB detects\nfailures

package "Error Response" {
    rectangle "Client" as EC #E3F2FD
    rectangle "Server" as ES #E8F5E9
    rectangle "Error" as ER #FFEBEE
    
    EC --> ES : request
    ES --> ER : failure
    ER --> EC : code + msg
}

note bottom of ER
  HTTP status, Error code
  Message, Correlation ID
  (No internal details)
end note
@enduml
