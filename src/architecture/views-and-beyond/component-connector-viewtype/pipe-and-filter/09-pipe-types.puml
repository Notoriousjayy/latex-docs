@startuml
title Pipe Types (Pipe-and-Filter)

left to right direction
skinparam componentStyle rectangle

' --- Unbuffered / Direct Pipe -------------------------------------------------
rectangle "Unbuffered Pipe" as R1 {
  component "Producer" as UP_PROD <<source>>
  component "Transform" as UP_XFORM <<transformer>>
  component "Consumer" as UP_CONS <<sink>>

  UP_PROD -right-> UP_XFORM : data stream
  UP_XFORM -right-> UP_CONS : data stream

  note bottom of UP_XFORM
    Minimal buffering
    Backpressure couples stages
  end note
}

' --- Buffered Pipe ------------------------------------------------------------
rectangle "Buffered Pipe" as R2 {
  component "Producer" as BP_PROD <<source>>
  queue "Buffer" as BP_BUF
  component "Consumer" as BP_CONS <<sink>>

  BP_PROD -right-> BP_BUF : enqueue
  BP_BUF -right-> BP_CONS : dequeue

  note bottom of BP_BUF
    Decouples producer/consumer rates
    Adds latency + memory footprint
  end note
}

' --- Typed Pipe ---------------------------------------------------------------
rectangle "Typed Pipe" as R3 {
  component "Producer" as TP_PROD <<source>>
  component "Schema\nValidation" as TP_SCHEMA <<transformer>>
  component "Consumer" as TP_CONS <<sink>>

  TP_PROD -right-> TP_SCHEMA : data
  TP_SCHEMA -right-> TP_CONS : validated

  note bottom of TP_SCHEMA
    Enforces data contracts
    Catches errors early
  end note
}

' --- Error Channel ------------------------------------------------------------
rectangle "Error Channel Pipe" as R4 {
  component "Producer" as EP_PROD <<source>>
  component "Transform" as EP_XFORM <<transformer>>
  component "Consumer" as EP_CONS <<sink>>
  component "Error Handler" as EP_ERR <<transformer>>

  EP_PROD -right-> EP_XFORM : data
  EP_XFORM -right-> EP_CONS : ok

  EP_XFORM -down-> EP_ERR : errors

  note bottom of EP_ERR
    Separates happy-path vs failures
    Enables retries / dead-lettering
  end note
}

@enduml
