
\documentclass[11pt,a4paper]{article}

\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{lmodern}
\usepackage{inconsolata}
\usepackage{upquote}
\usepackage{microtype}
\usepackage[margin=1in]{geometry}
\usepackage{parskip}
\usepackage[hyphens]{url}
\usepackage{hyperref}
\usepackage{bookmark}
\usepackage{enumitem}
\usepackage{ragged2e}
\usepackage{array}
\usepackage{tabularx}
\usepackage[most]{tcolorbox}
\usepackage{xcolor}
\usepackage{amssymb,amsmath}

\definecolor{Primary}{HTML}{0E7490}
\definecolor{Accent}{HTML}{0EA5E9}
\definecolor{Soft}{HTML}{F1F5F9}
\definecolor{Ink}{HTML}{0F172A}
\definecolor{Meta}{HTML}{475569}

\hypersetup{colorlinks=true, linkcolor=Primary, urlcolor=Primary}

\tcbset{colback=Soft, colframe=Meta!60, colbacktitle=Soft!60, coltitle=black, arc=2pt, boxrule=0.4pt}

\newtcbox{\pill}{on line, arc=3pt, boxsep=0.8pt, left=4pt,right=4pt,top=1pt,bottom=1pt,
  colframe=Meta!60, colback=Soft!40, boxrule=0.3pt}
\newcommand{\badge}[1]{\pill{\footnotesize #1}}
\newcommand{\checkbox}{\(\square\)}
\newcommand{\checkedbox}{\(\blacksquare\)}
\newcommand{\DoR}{\textbf{Definition of Ready:} Persona clear; AC drafted; Dependencies known; Estimate set.}
\newcommand{\DoD}{\textbf{Definition of Done:} All ACs pass; Tests green; Security/a11y checks; Docs updated; Deployed/flagged.}
\let\cb\checkbox

% Story card box
\newtcolorbox{storyframe}[1]{enhanced,breakable,
  left=8pt,right=8pt,top=8pt,bottom=8pt,
  borderline west={2pt}{0pt}{Primary},
  title={\textbf{#1}}, fonttitle=\bfseries\large}

% Tasks box
\newenvironment{TasksBox}[1][Tasks]{%
  \begin{tcolorbox}[enhanced,breakable,
    colback=Soft!10, colframe=Meta!60,
    colbacktitle=Soft!60, coltitle=black,
    title={#1}, fonttitle=\bfseries,
    borderline west={1.8pt}{0pt}{Primary},
    left=10pt,right=10pt,top=6pt,bottom=6pt,
    before skip=6pt, after skip=10pt]
  \small
  \begin{itemize}[label=\cb, leftmargin=*, labelsep=0.6em, itemsep=4pt, topsep=2pt, parsep=0pt]
}{%
  \end{itemize}
  \end{tcolorbox}
}

% StoryCard macro (no custom coltypes; use explicit p{..} and X)
\newcommand{\StoryCard}[9]{%
  \begin{storyframe}{#1 — #2}
  \small
  \begin{tabularx}{\textwidth}{@{}>{\RaggedLeft\arraybackslash\bfseries}p{3.2cm}>{\RaggedRight\arraybackslash}X@{}}
    Epic / Feature          & #3 \\
    Business Value          & #4 \\
    Priority / Estimate     & \badge{Priority: #5}\ \badge{SP: #6} \\
    Persona                 & #7 \\
    Dependencies            & #8 \\
    Assumptions / Risks     & #9 \\
  \end{tabularx}

  \medskip
  \textbf{Story}\quad
  \emph{As a #7, I want to #2 so that #4.}

  \medskip
  \textbf{Non-Functional}\quad
  \badge{Performance}\ \badge{Security}\ \badge{Reliability}\ \badge{Accessibility}\ \badge{Privacy}\ \badge{i18n}

  \medskip
  \textbf{Acceptance Criteria (BDD)}
  \begin{description}[leftmargin=2.4cm,labelsep=1em]
    \item[\textbf{Scenario}] Happy path
    \item[\textbf{Given}] the target repositories, environments, and context are available
    \item[\textbf{When}] the Hands-on Objectives for this chapter are executed
    \item[\textbf{Then}] the stated Outcomes/Deliverables for this chapter are produced, reviewed, and published
  \end{description}

  {\footnotesize\color{Meta}\DoR\ \textbullet\ \DoD}
  \end{storyframe}
}

\title{\textbf{Study Plan — NGINX Cookbook, 3rd Edition}\\
\large User Story Template \& Story Card Definition}
\author{}
\date{\today}

\begin{document}
\maketitle
\tableofcontents
\clearpage

\section{How to Use This Template}
\begin{enumerate}
  \item Start with the \textbf{one-sentence story} (persona, goal, value).
  \item Add \textbf{acceptance criteria} in Gherkin (Given/When/Then).
  \item Capture \textbf{non-functional requirements} (performance, security, accessibility, \ldots).
  \item Confirm \textbf{Definition of Ready} (DoR) before sprint; confirm \textbf{Definition of Done} (DoD) before acceptance.
  \item Keep stories \textbf{INVEST}: Independent, Negotiable, Valuable, Estimable, Small, Testable.
\end{enumerate}

\clearpage

\section{Study Plan — Story Cards by Chapter}

% --- HS-1 ---
    \StoryCard{HS-1}{Getting Started}{Foundations}
    {Establish a clean install and configuration layout to reduce integration risk and speed future chapters.}
    {Must}{3}{Developer or SRE on a fresh machine}
    {Linux host or container; build tools; Git}
    {Package vs. source builds diverge; misconfigured services or ports}

    \begin{TasksBox}
    \item Create \texttt{labs/01-install}; initialize Git.
\item Install with \texttt{apt} (or distro equivalent); validate with \texttt{nginx -t} and a default site.
\item Build from source enabling PCRE, zlib, and TLS; save \texttt{nginx -V} output to the repo.
\item Add a \texttt{systemd} override for limits and graceful reload; verify \texttt{nginx -s reload}.
\item Commit baseline config layout with \texttt{conf.d}/ and \texttt{sites-available}/\texttt{sites-enabled}.
\end{TasksBox}

    \clearpage

% --- HS-2 ---
    \StoryCard{HS-2}{HTTP Core}{Configuration Hygiene}
    {Provide a predictable layout and reload-safe iteration to reduce errors and speed delivery.}
    {Must}{3}{Developer building the first site}
    {Chapter 1 complete; text editor; curl}
    {Confusion about include order; missing reload tests cause outages}

    \begin{TasksBox}
    \item Create \texttt{labs/02-basics}; define \texttt{http}, \texttt{server}, and \texttt{location} blocks.
\item Move site configs into \texttt{sites-available} with symlink from \texttt{sites-enabled}.
\item Add \texttt{gzip}, a common \texttt{log\_format}, and a maintenance switch via \texttt{map}.
\item Run \texttt{nginx -t} and \texttt{nginx -T}; capture outputs in the repo.
\item Write a tiny script that curls a few endpoints and verifies 200/404/405 responses.
\end{TasksBox}

    \clearpage

% --- HS-3 ---
    \StoryCard{HS-3}{Routing and HTTP/2}{Routing}
    {Route requests correctly and enable modern protocol support to improve UX and capacity.}
    {Must}{3}{SRE responsible for front-door behavior}
    {Certificate or self-signed for local testing}
    {Locations mis-ordered; cache headers set incorrectly}

    \begin{TasksBox}
    \item Create \texttt{labs/03-http}; implement \texttt{/}, \texttt{/static/}, and \texttt{/api} with correct precedence.
\item Enable TLS and HTTP/2 on the listener; verify ALPN negotiation.
\item Add cache-control for static assets and ETag where appropriate.
\item Validate location priority with explicit test requests; record results.
\end{TasksBox}

    \clearpage

% --- HS-4 ---
    \StoryCard{HS-4}{Security and Policy}{Defense in Depth}
    {Centralize safe defaults (TLS params, limits, and canonical headers) to reduce risk and variance.}
    {Must}{3}{Security-minded operator}
    {Chapters 2 and 3 complete}
    {Overzealous rate limits can block users; TLS misconfiguration causes handshake failures}

    \begin{TasksBox}
    \item Create \texttt{labs/04-modules}; add a \texttt{map}-based include for common headers.
\item Add \texttt{limit\_req\_zone} and \texttt{limit\_conn\_zone}; test with a simple load tool.
\item Create \texttt{ssl/params.conf} with ciphers, curves, and stapling; reference from servers.
\item Document a safe CORS policy and error mapping.
\end{TasksBox}

    \clearpage

% --- HS-5 ---
    \StoryCard{HS-5}{Dynamic Backends}{Application Integration}
    {Serve dynamic content efficiently via FastCGI and uWSGI.}
    {Should}{3}{Full-stack engineer}
    {php-fpm or uWSGI installed; example apps}
    {Incorrect FastCGI params; buffer/timeout mismatches}

    \begin{TasksBox}
    \item Create \texttt{labs/05-php-python}; add a PHP info page behind FastCGI.
\item Configure Django via uWSGI and an NGINX vhost.
\item Document buffer and timeout tuning choices.
\end{TasksBox}

    \clearpage

% --- HS-6 ---
    \StoryCard{HS-6}{Gateway}{Reverse Proxy}
    {Expose upstream services reliably with caching and resilient error handling.}
    {Must}{3}{Platform engineer}
    {Upstream app at port 3000 or similar}
    {Missing real-IP forwarding; WebSocket upgrade issues}

    \begin{TasksBox}
    \item Create \texttt{labs/06-revproxy}; proxy to a local Node API and a static site.
\item Configure cache bypass on auth headers; set appropriate proxy timeouts.
\item Verify WebSocket upgrade and error handling behavior.
\end{TasksBox}

    \clearpage

% --- HS-7 ---
    \StoryCard{HS-7}{Scale and Throughput}{Load Balancing}
    {Improve throughput and resilience via load balancing and connection tuning.}
    {Should}{3}{SRE benchmarking performance}
    {Three backend containers; benchmarking tool}
    {Neglecting upstream failure handling; misleading benchmarks}

    \begin{TasksBox}
    \item Create \texttt{labs/07-lb-optim}; define an upstream with three nodes.
\item Set \texttt{max\_fails} and \texttt{fail\_timeout}; run before/after measurements.
\item Experiment with \texttt{least\_conn} and keepalive; capture metrics.
\item Document findings in \texttt{bench-notes.md}.
\end{TasksBox}

    \clearpage

% --- HS-8 ---
    \StoryCard{HS-8}{Containers and Deployment}{Cloud-Ready Images}
    {Use containers for reproducible stacks and faster delivery.}
    {Should}{3}{DevOps engineer}
    {Docker and Compose installed}
    {State drift inside containers; missing read-only FS}

    \begin{TasksBox}
    \item Create \texttt{labs/08-cloud-docker} with \texttt{Dockerfile} and \texttt{docker-compose.yml}.
\item Add healthchecks and environment overlays.
\item Document image hardening steps and entrypoint.
\end{TasksBox}

    \clearpage

% --- HS-9 ---
    \StoryCard{HS-9}{Automation}{Ansible Deploy, Manage, and Auto-Update}
    {Make changes safe, repeatable, and observable with a simple playbook and CI gate.}
    {Should}{3}{Infra engineer}
    {Ansible controller; test hosts or containers with SSH}
    {Careless rolling updates; template drift}

    \begin{TasksBox}
    \item Create \texttt{labs/09-ansible/roles/nginx}; add install, config, and service tasks.
\item Write \texttt{site.yml} and run against two targets with \texttt{--check} and then \texttt{--diff}.
\item Add a CI lint-and-test workflow that runs \texttt{nginx -t} before deploy.
\end{TasksBox}

    \clearpage

% --- HS-10 ---
    \StoryCard{HS-10}{Certificates and Apps}{Reusable Templates}
    {Standardize TLS and app includes so launches are fast and reliable.}
    {Could}{2}{Platform owner}
    {Local CA or staging certs; WordPress or Nextcloud sample}
    {Certificate chain failures; large upload limits for apps}

    \begin{TasksBox}
    \item Create \texttt{labs/10-cases/ssl}; script staging cert issuance.
\item Prepare \texttt{ssl/params.conf} include; reference across vhosts.
\item Deploy a sample app; validate uploads and caching behavior.
\end{TasksBox}

    \clearpage

% --- HS-11 ---
    \StoryCard{HS-11}{Diagnostics}{Troubleshooting}
    {Speed incident resolution through systematic debugging and logging.}
    {Must}{3}{On-call SRE}
    {nginx-debug binary or increased log level; test client; broken configs to diagnose}
    {Cognitive pressure during incidents; red herrings}

    \begin{TasksBox}
    \item Create \texttt{labs/11-troubleshooting}: 403 perms, bad FastCGI params, broken includes.
\item Resolve each and add a short postmortem with evidence (log excerpts, \texttt{curl} output).
\item Update a troubleshooting decision tree.
\end{TasksBox}

    \clearpage

% --- HS-12 ---
    \StoryCard{HS-12}{Integration}{Capstone}
    {Demonstrate production-like competency end to end.}
    {Must}{5}{Engineer presenting a portfolio artifact}
    {Completed chapters; Docker and Ansible}
    {Scope creep; timeboxing required}

    \begin{TasksBox}
    \item Compose stack in \texttt{labs/capstone}; reuse includes and templates.
\item Add JSON logs and a quick view.
\item Capture a short demo script and screenshots.
\end{TasksBox}

    \clearpage

\end{document}
